<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script> 
<script src="../site_media/highcharts.js" type="text/javascript"></script>

<!--
<script src="site_media/chart_example.js" type = "text/javascript"></script>
-->
<div id="chart-container-1" class="highcharts-container" style="width: 100%;
    position: absolute; top: 0 px; left: 0 px;
    height: 100% margin: 0 2; clear:both"></div>

<div id="text-container" style="position: absolute; top: 400px; left: 15 px; margin: 0 2;">
</div>

<script type = "text/javascript">

var chart1; // globally available

function load_data()
{
    power_array = [];
    $.get('/power/{{data_list.field}}/{{data_list.field_val}}/data',
        //{'data': JSON.stringify(message) },
        function(data, XMLHttpRequest) {
            data = JSON.parse(data);
            total_power = 0;
            console.log('Received data');
            if(data.length <= 0)
            {
                alert("No data was found for this query.\nThere is a minimum\
 amount of time the program must run in order for the daq to return significant\
 results.\nTherefore, consider increasing the time spent for your program.");
                return; 
            }
            for(i = 0; i < data.length; i++)
            {
                power_array[i] = data[i].power;
                total_power += data[i].power;
            }
            chart1.series[0].setData(power_array,true);
            // Get Energy: 
            // Total power * # measurements/(sampling rate/# channels)
            document.getElementById("text-container").textContent= "Energy: "
            + total_power/(1000/16);
            
    
        }
    );
}

$(document).ready(function() {
      chart1 = new Highcharts.Chart({
         chart: {
            renderTo: 'chart-container-1',
            zoomType: 'x',
            defaultSeriesType: 'line',
            events: {
                load: load_data
            }
         },
         title: {
            text: 'Power Measurements for {{data_list.field}} = {{data_list.field_val}} '
         },
         xAxis: {
            title: {
                text: 'Time (Seconds)'
            }
         },
         yAxis: {
            title: {
               text: 'Power (Watts)'
            }
         },
         series: [{
            name: 'Power',
            pointInterval: 0.016,
            data: [] 
         }
         ]
      });
    })

</script>
